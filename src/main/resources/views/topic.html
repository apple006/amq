<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>AMQ TOPIC</title>
    <script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/riot@3.7.4/riot+compiler.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/riot-route@x.x.x/dist/route.min.js"></script>
</head>
<tag-load>
    <script type="riot/tag" src="/views/asset/tags/topic_list.tag.html"></script>
</tag-load>
<body>
<topiclist>主题列表</topiclist>
</body>
</html>
<script>
    window.eventBus = riot.observable();  // riot 的事件观察
    var tag = this;

    //路由
    var r = route.create();
    r("views..", function () {
        viewOf(route);
    });

    function viewOf(route) {
        eventBus.trigger('open', {view: 'viewbox', uri: "/" + route.uri, params: route.params});
    }

    //自定义改写route对于路径的解析
    route.parser(function (path) {
        var raw = path.split('?'),
            uri = raw[0],
            qs = raw[1],
            params = {}
        if (qs) {
            qs.split('&').forEach(function (v) {
                var c = v.split('=')
                params[c[0]] = c[1]
            });
        }
        //属性回写到route
        route.uri = uri;
        route.params = params;
        return route;
    });

    eventBus.on('tree_data', function (data) {
        console.log("data hoe=" + data);

    });

    //取得菜单内容
    function fetchMenuData() {
        $.getJSON(targetUrl, function (data) {
            eventBus.trigger("tree_data", data);
            return data;
        });

    }

    //加载所有TAG
    riot.mount('*');
    route.start(true);

</script>